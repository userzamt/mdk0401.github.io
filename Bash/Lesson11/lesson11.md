# Урок 11. Функции

[На главную](/mdk0401.github.io)

Подобно "настоящим" языкам программирования, Bash тоже имеет функции, хотя и в несколько ограниченном варианте. 

**Функция** - это подпрограмма, блок кода который реализует набор операций, своего рода "черный ящик", предназначенный для выполнения конкретной задачи. Функции могут использоваться везде, где имеются участки повторяющегося кода.

## Объявление функций
Функцию можно объявить несколькими способами

```bash
function function_name {
    command1
    ...
    commandN
}

# или

function_name () {
    command1
    ...
    commandN
}
```

Вторая форма записи ближе к сердцу C-программистам (она же более переносимая).

Как и в языке C, скобка, открывающая тело функции, может помещаться на следующей строке.

```bash
function_name ()
{
    command1
    ...
    commandN
}
```
Функцию можно вызвать без аргументов и с аргументами.

## Использование функций
Вызов функции осуществляется простым указанием ее имени в тексте сценария. Функцию можно вызывать столько раз, сколько нужно.

```bash
function msgHi() {
    echo "Hello from $$"
}

msgBay () {
    echo "Bay bay my $$"
}

msgHi
sleep 3
msgBay
```

Функция должна быть объявлена раньше, чем ее можно будет использовать. К сожалению, в Bash нет возможности "опережающего объявления" функции, как например в C.

```bash
funky   # error

funky () {
  echo "Это обычная функция."
} # Функция должна быть объявлена раньше, чем ее можно будет использовать.

# Вызов функции.
funky

exit 0
```

Придумывая имена для функций, учитывайте то, что они должны быть уникальными, иначе проблем не избежать. Если переопределить ранее объявленную функцию, новая функция будет вызываться вместо старой без каких-либо уведомлений или сообщений об ошибках.

```bash
whoami      # !!!!

whoami() {
    echo $USER
}

whoami      # ivanov

whoami() {
    echo "My name is $USER"
}

whoami      # My name is ivanov
```

Как видно, новая функция преспокойно затёрла старую и не только. 

> [!WARNING]
> Команда ```whoami``` выводит имя текущего пользователя. В результате предыдущего примера данная команда была затёрта функцией

## Код завершения
**Функции возвращают значение в виде кода завершения.** Код завершения может быть задан явно, с помощью команды ```return```, в противном случае будет возвращен код завершения **последней команды** в функции (0 - в случае успеха, иначе - ненулевой код ошибки). 

Код завершения в сценарии может быть получен через переменную ```$?```.

### ```return```
Завершает исполнение функции. Команда ```return``` может иметь необязательный аргумент типа *integer*, который возвращается в вызывающий сценарий как *"код завершения"* функции, это значение так же записывается в переменную ```$?```.

Есть два способа работы с тем, что является результатом вызова функции. Первый

```bash
function badSumm() {
    read -p "Введите два числа для сложения: " n1 n2
    return $(( $n1 + $n2 ))
}

badSumm
echo "Сумма = $?"
```

**Наибольшее положительное целое число, которое может вернуть функция - 255.** Команда ```return``` очень тесно связана с понятием код завершения, что объясняет это специфическое ограничение. К счастью существуют различные способы преодоления этого ограничения.

Если функция должна возвращать большее число или строку, понадобится другой подход.


## Запись вывода функции в переменную
Ещё один способ возврата результатов работы функции заключается в записи данных, выводимых функцией, в переменную. Такой подход позволяет обойти ограничения команды ```return``` и возвращать из функции любые данные.

```bash
sum() {
    read -p "Введите два числа для сложения: " n1 n2
    echo $(( $n1 + $n2 ))
}

result=$( sum )
echo "Ответ: $result"
```

