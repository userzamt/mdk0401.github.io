# Урок 12. sed и обработка текстов

[На главную](/mdk0401.github.io)

**Sed** (от англ. Stream EDitor) — консольная утилита для редактирования текстовых потоков.

Sed неинтерактивный строчный редактор, который принимает текст либо с устройства `stdin`, либо из текстового файла, выполняет некоторые операции над строками и затем выводит результат на устройство `stdout` или в файл. 

Как правило, в сценариях, `sed` используется в конвейерной обработке данных, совместно с другими командами и утилитами.

```bash
sed OPTIONS... [SCRIPT] [INPUTFILE...]
```

Утилиту `sed` называют **потоковым текстовым редактором**. В интерактивных текстовых редакторах, наподобие `nano`, с текстами работают, используя клавиатуру, редактируя файлы, добавляя, удаляя или изменяя тексты. `Sed` позволяет редактировать потоки данных, основываясь на заданных разработчиком наборах правил. 

## Отличие от других редакторов
Раньше текстовые файлы просматривались/обрабатывались построчно, т.е. пользователь, работая на терминале, не видел содержимого целиком, и строка за строкой делал свои изменения. С другой стороны, текст мог поступать на терминал порциями и получался тот же эффект. Во всех этих случаях поступающий текст образует поток символов (*stream*).

Команда `Sed` позволяет определить некоторые правила обработки (написать микропрограмму обработки) для каждой строки в потоке, и в этом собственно ее основная функция. Правила обработки составляется на внутреннем языке `Sed`, который объявляет специальные команды по типу заменить, удалить, подставить и т.п. Составляя из этих команд комбинации, можно писать очень сложные процедуры обработки, которые покрывают большую часть потребностей, встречающихся на практике. 

> [!IMPORTANT]
> У языка `Sed` есть недостаток в том, что он не такой очевидный и иногда сложный, и не посвященному пользователю он будет не понятен.

К типичным задачам `Sed` можно отнести следующие:

+ Вывод исходного файла фрагментами;

+ Замена подстрок в файле по регулярным выражениям;

+ Удаление/Вставка/Изменение фрагментов исходного текста файла по некоторым правилам, в частности, Sed довольно часто используют для автоматизированной правки конфигурационных файлов системы.

Более мощной альтернативой `Sed` является консольная утилита `Awk`, смысл которой такой же, но язык написания правил обработки сложнее и богаче. Однако, практика показывает, что сначала нужно попробовать решить задачу с помощью `Sed`, вместо того, чтобы *«стрелять по воробьям из базуки»*. 

## Введение в синтаксис
По умолчанию sed применяет указанные при вызове правила, выраженные в виде набора команд, к `STDIN`. Это позволяет передавать данные непосредственно `sed`.

```bash
echo "This is a test" | sed 's/test/another test/'
```

В данном случае `sed` заменяет слово *«test»* в строке, переданной для обработки, словами *«another test»*. Для оформления правила обработки текста, заключённого в кавычки, используются прямые слэши. В нашем случае применена команда вида `s/pattern1/pattern2/`. 

Буква *«s»* — это сокращение слова *«substitute»*, то есть — перед нами команда замены. `Sed`, выполняя эту команду, просмотрит переданный текст и заменит найденные в нём фрагменты (о том — какие именно, поговорим ниже), соответствующие `pattern1`, на `pattern2`.

Выше приведён примитивный пример использования `sed`, нужный для того, чтобы ввести вас в курс дела. На самом деле, `sed` можно применять в гораздо более сложных сценариях обработки текстов, например — для работы с файлами.

```bash
sed 's/test/another test' ./myfile
```

Здесь применён тот же подход, который использовался выше, но теперь `sed` обрабатывает текст, хранящийся в файле. При этом, если файл достаточно велик, можно заметить, что `sed` обрабатывает данные порциями и выводит то, что обработано, на экран, не дожидаясь обработки всего файла.

**`Sed` не меняет данные в обрабатываемом файле.** Редактор читает файл, обрабатывает прочитанное, и отправляет то, что получилось, в `STDOUT`. 

При необходимости вывод `sed` можно перенаправить в файл, возможно — перезаписать старый файл.