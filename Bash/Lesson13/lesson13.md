# Урок 13. Язык обработки данных awk

[На главную](/mdk0401.github.io)

![awk](https://upload.wikimedia.org/wikipedia/commons/thumb/d/d5/The-AWK-Programming-Language.svg/350px-The-AWK-Programming-Language.svg.png)

**Awk** — утилита и реализованный в ней сценарный язык для построчного разбора и редактирования текстового потока. `Awk` развила идеи таких утилит, как `Sed` и `Grep`, поэтому многое в ней похоже на них. 

**AWK** - утилита предназначенная для простых, механических и вычислительных манипуляций над данными. Довольно несложные операции часто необходимо выполнить над целыми пакетами файлов, а писать для этого программу на одном из стандартных языков программирования является утомительным и, как правило, не очень простым делом. Оптимальное решение проблемы - использование специальной утилиты `AWK`, включающей в себя не громоздкий и удобный **язык программирования**, позволяющий решать задачи обработки данных с помощью коротких программ, состоящих из двух-трех строк.

Утилита `AWK` изначально объединяла свойства утилит UNIX - `sed` и `grep`. В дальнейшем ее возможности значительно расширились. 

> [!NOTE]
> Утилита `AWK` была создана в 1977г, американскими авторами: **Alfred V.Aho**, **Brian W.Kernighan** и **Peter J.Weinberger**. Подробное описание всех возможностей утилиты AWK для UNIX дает их издание: *The AWK Programming Language, 1988*.

По сравнению с `Sed`, язык `Awk` больше похож на Си и имеет множество его возможностей, такие как:

+ объявление переменных и массивов с динамической типизацией;
+ арифметические операции;
+ ветвления и циклы;
+ объявление функций и использование библиотеки встроенных функций.

`Awk` по сути является продолжателем `Sed`, привнося в процесс поточной обработки такие улучшения, как:

+ автоматическая разбивка входящего фрагмента на поля, причем с возможностью смены разделителя на ходу;
+ улучшенный процедурный язык программирования с переменными, циклами, функциями и условиями;
множество встроенных переменных, облегчающих парсинг входящего фрагмента;
+ возможность передавать переменные из вызова в программу.

`Awk` часто применяется для
+ поиска в текстовых файлах характерных фрагментов;
+ анализа текста и сбора статистики;
+ написания простых утилит редактирования, когда использование компилируемого языка не рационально.

> [!WARNING]
> `Awk` разрабатывался много лет, поэтому на практике вы можете столкнуться с разными реализациями. 

## Варианты вызова
В простом случае вызов `Awk` выглядит так

```bash
awk опции 'условие {действие}' <файл 1> <файл 2>... <файл N>
```

В данном вызове `Awk` будет выполнять свою программу над каждым переданным файлом по порядку.


Обрабатываемый текст может передаваться утилите и другими средствами командной оболочки:

```bash
# По конвейеру в STDIN
echo "hello" | awk '{print}'

# Направление строки в STDIN (первый вариант)
awk '{print}' <<< "hello"

# Направление строк в STDIN через Here-docs (второй вариант)
awk '{print}' <<EOF
hello
EOF

# Перенаправив поток через дескриптор
awk '{print}' < file.txt
# аналогично
awk '{print}' file.txt
```

> [!IMPORTANT]
> Если `Awk` не получает в качестве ввода файл, то он читает просто `STDIN`, который обычно связывается с клавиатурой (интерактивный режим).


```bash
awk опции 'условие {действие} условие {действие}
```

`Awk` воспринимает поступающие к нему данные в виде набора записей. Записи представляют собой наборы полей. Упрощенно, если не учитывать возможности настройки `awk` и говорить о некоем вполне обычном тексте, строки которого разделены символами перевода строки, запись — это строка. Поле — это слово в строке.

Наиболее часто используемые ключи(опции) командной строки `awk`:

+ `-F fs` — позволяет указать символ-разделитель для полей в записи.
+ `-f file` — указывает имя файла, из которого нужно прочесть `awk`-скрипт.
+ `-v var=value` — позволяет объявить переменную и задать её значение по умолчанию, которое будет использовать `awk`.
+ `-mf N` — задаёт максимальное число полей для обработки в файле данных.
+ `-mr N` — задаёт максимальный размер записи в файле данных.
+ `-W keyword` — позволяет задать режим совместимости или уровень выдачи предупреждений `awk`.

## Чтение awk-скриптов из командной строки
Скрипты `awk`, которые можно писать прямо в командной строке, оформляются в виде текстов команд, заключённых в **фигурные скобки**. Кроме того, так как `awk` предполагает, что скрипт представляет собой текстовую строку, его нужно заключить в **одинарные кавычки**:

```bash
awk '{print "Welcome to awk command tutorial"}'
```

Запустим эту команду… И ничего не произойдёт Дело тут в том, что мы, при вызове awk, не указали файл с данными. В подобной ситуации awk ожидает поступления данных из `STDIN`. Поэтому выполнение такой команды не приводит к немедленно наблюдаемым эффектам, но это не значит, что awk не работает — он ждёт входных данных из `STDIN`.

Если теперь ввести что-нибудь в консоль и нажать `Enter`, `awk` обработает введённые данные с помощью скрипта, заданного при его запуске. `Awk` обрабатывает текст из потока ввода построчно, этим он похож на `sed`. В данном случае `awk` ничего не делает с данными, он лишь, в ответ на каждую новую полученную им строку, выводит на экран текст, заданный в команде `print`.

> [!WARNING]
> Для того, чтобы завершить работу `awk`, нужно передать ему символ конца файла (EOF, End-of-File). Сделать это можно, воспользовавшись сочетанием клавиш `CTRL + D`.


