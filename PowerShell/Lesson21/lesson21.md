# Урок 21. Модули

[На главную](/mdk0401.github.io)

`PowerShell`-модуль в чистом виде представляет собой текстовый файл с расширением `.psm1` и дополнительными метаданными. 

Существуют и другие типы — бинарные модули и динамические модули, но эти понятия выходят за рамки данного урока. 

Любая команда, которая явным образом не выполнялась в сеансе работы `PowerShell`, почти наверняка исходит из модуля. Многие  команды являются частью встроенных модулей *Microsoft*, которые идут в комплекте с `PowerShell`. Помимо них также бывают сторонние модули, в том числе те, которые вы сами создаете. Чтобы использовать модуль, его сначала нужно **установить**. Затем, если необходимо использовать команду из модуля, сам модуль должен быть **импортирован** в ваш сеанс. Начиная с версии *PowerShell v3*, **среда автоматически импортирует модуль** при попытке вызвать из него команду. 

## Поиск модулей в сеансе
Просмотреть импортированные в текущий сеанс модули можно с помощью командлета `Get-Module` (который сам является частью модуля). Это команда, которая позволяет просмотреть все имеющиеся в системе модули, доступные в текущем сеансе.

```powershell
Get-Module
```

Каждая строка выходных данных команды `Get-Module` представляет собой модуль, который был импортирован в текущий сеанс. Это означает, что все команды этого модуля можно использовать в любой момент. Модули `Microsoft.PowerShell.Management` и `Microsoft.PowerShell.Utility` по умолчанию импортируются в любой сеанс `PowerShell`. 

Обратите внимание на столбец `ExportedCommands`. Это те команды из модуля, которые вы можете использовать. Все варианты можно посмотреть с помощью `Get-Command` с указанием имени модуля. 

```powershell
Get-Command -Module Microsoft.PowerShell.Management
```

Здесь перечислены все команды, которые были экспортированы из этого модуля — их можно вызвать и вне его. Некоторые авторы любят включать в свои модули функции, недоступные для пользователя. Любая функция, которая не экспортируется и работает только внутри сценария или модуля, называется **приватной функцией** или, как иногда говорят, **вспомогательной функцией**. 

Использование команды `Get-Module` без каких-либо параметров вернет все импортированные модули, но **что насчет модулей, которые были установлены, но не импортированы?**

## Поиск модулей на компьютере
Чтобы вывести список всех модулей, которые установлены в системе и могут быть импортированы в ваш сеанс, можно использовать команду `Get-Module` с параметром `-ListAvailable`

```powershell
Get-Module -ListAvailable
```

Параметр `ListAvailable` просит `PowerShell` проверить наличие в папках вложенных папок с файлами `.psm1`. `PowerShell` прочитает каждый из этих модулей в файловой системе и вернет вам имя, метаданные и список функций каждого модуля, которые можно использовать. 

`PowerShell` ищет модули в нескольких местах на жестком диске, заданных по умолчанию типом модуля:

+ **Системные модули**: почти все модули, которые идут в комплекте с `PowerShell`, будут расположены в папке *C:\Windows\System32\WindowsPowerShell\1.0\Modules*. Этот путь обычно используется только для внутренних PowerShell-модулей. В принципе, вы можете размещать в этой папке и свои модули, но делать это не рекомендуется. 

+ **Модули, доступные всем пользователям**: модули также хранятся в папке *C:\Program Files\WindowsPowerShell\Modules*. Этот путь обычно называют путем *«Для всех пользователей»*, и именно здесь находятся все модули, которые должны быть доступны всем пользователям системы. 
+ **Модули текущего пользователя**: наконец, вы можете хранить модули в папке *C:\Users\<ТекущийПользователь>\Documents\WindowsPowerShell\Modules*. Внутри этой папки вы найдете все созданные или загруженные вами модули, которые доступны только текущему пользователю. Размещение модулей по этому пути позволяет разделить их на случай, если за компьютером работают несколько пользователей.

При вызове команды `Get-Module -ListAvailable` PowerShell считывает все пути к этим папкам и возвращает все расположенные там модули. Тем не менее это лишь пути для модулей по умолчанию — при необходимости вы можете добавить свои.

Можно создать новый путь к модулю с помощью переменной среды `$PSModulePath`, в которой определены все папки с модулями. Они разделены точкой с запятой

```powershell
$env:PSModulePath -split ';'
```

> [!IMPORTANT]
> Вы можете добавить свою папку с модулями в переменную среды `PSModulePath`, но имейте в виду, что в этом случае новая папка добавится только в текущий сеанс.


