# Урок 20. Функции в PowerShell

[На главную](/mdk0401.github.io)

До настоящего момента мы работали преимущественно со стандартными скомпилированными командлетами, функциональность которых нельзя изменить, так как их исходный код в оболочке `PowerShell` недоступен. **Функции и сценарии** — это два других типа команд `PowerShell`, которые можно создавать и изменять по своему усмотрению, пользуясь языком `PowerShell`. 

> [!NOTE] 
> Следует сразу обратить внимание, что функции в `PowerShell` **имеют некоторые особенности** по сравнению с функциями в традиционных языках программирования, так как `PowerShell` — это в первую очередь оболочка. 

`PowerShell` **функция — это команда**. Отсюда различие в способах вызова функций и передачи им аргументов. Обычно функции в традиционных языках возвращают единственное значение того или иного типа. *"Значением"* функции `PowerShell` может быть целый массив различных объектов, так как каждое вычисляемое в функции выражение помещает свой результат в выходной поток. Кроме того, функции в `PowerShell` делятся на несколько типов согласно их поведению внутри конвейера команд. 

**Функция** в `PowerShell` — это блок кода, имеющий название и находящийся в памяти до завершения текущего сеанса командной оболочки.

```powershell
function Verb-Noun {
   # code
}
```

Если функция определяется без формальных параметров, то для ее задания достаточно указать ключевое слово `Function`, затем имя функции и список выражений,  составляющих тело функции (данный список должен быть заключен в фигурные скобки).

```powershell
function Get-MyPSVersion {
    $PSVersionTable.PSVersion
}
```

После загрузки в память её можно найти

```powershell
Get-Command -CommandType Function

Get-PSDrive
Get-ChildItem Function:\Get-MyPSVersion
```

## Именование
Имена функций — важная деталь. Функцию  можно назвать как угодно, но имя всегда должно описывать то, что она делает. Соглашение об именах функций в `PowerShell` следует синтаксису *«глагол-существительное»*. 

Считается, что лучше всегда использовать этот синтаксис, если в другом нет острой необходимости. Можно использовать команду `Get-Verb`, чтобы просмотреть список рекомендуемых глаголов. В качестве существительного обычно выступает имя объекта, с которым работают, в единственном числе 

```powershell
Get-Verb
```

## Обработка аргументов функций с помощью переменной $Args 
Функция в `PowerShell` имеет доступ к аргументам, с которыми она была запущена, даже если при определении этой функции не были заданы формальные параметры. Все аргументы, с которыми была запущена функция, автоматически сохраняются в переменной `$Args`. Другими словами, в переменной `$Args` содержится массив, элементами которого являются параметры функции, указанные при ее запуске. 

```powershell
function Get-LastLog {
    Get-EventLog -LogName Application | Where-Object { $_.TimeWritten -ge (Get-Date).AddDays(-1) }
}

Get-LastLog
```

Учитывая, что может потребоваться получить данные не за последний час, а больше, то лучше передавать параметры.

```powershell
function Get-LastLog {
    $h = -$args[0]

    Get-EventLog -LogName Application | Where-Object { $_.TimeWritten -ge (Get-Date).AddHours($h) }
}

Get-LastLog 62
```

В отличие от традиционных языков программирования, функции в `PowerShell` являются командами (это не методы объектов!), поэтому их аргументы указываются через пробел без дополнительных круглых скобок и выделения символьных строк кавычками. 

```powershell
function Print-Args {
    Write-Host "Передано аргументов:" $args.count
    Write-Host "Аргумент 0:" $args[0]
    Write-Host "Аргумент 1:" $args[1] 
    Write-Host "Аргумент 2:" $args[2]
}


Print-Args Ноль Один 123
```

Описанный выше способ позволяет передать в сценарий или функцию любое количество параметров, но при вызове необходимо соблюдать порядок их следования, а обращаться к ним можно только по индексу массива — это не всегда удобно.
